<!DOCTYPE html>
<html lang="zh-CN">





<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/css/images/bg/favicon.ico">
  <link rel="icon" type="image/png" href="/css/images/bg/favicon.ico">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="摸鱼">
  <meta name="author" content="Aluvion">
  <meta name="keywords" content="">
  <title>RustWeb开发入门 - Twings</title>

  <link  rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/5.12.1/css/all.min.css" />
<link  rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/css/bootstrap.min.css" />
<link  rel="stylesheet" href="https://cdn.staticfile.org/mdbootstrap/4.13.0/css/mdb.min.css" />
<link  rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/3.0.1/github-markdown.min.css" />

<link rel="stylesheet" href="//at.alicdn.com/t/font_1067060_qzomjdt8bmp.css">



  <link  rel="stylesheet" href="/lib/prettify/tomorrow-night-eighties.min.css" />

<link  rel="stylesheet" href="/css/main.css" />


  <link defer rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css" />


<!-- 自定义样式保持在最底部 -->


<meta name="generator" content="Hexo 7.3.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>Twings</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/">首页</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/archives/">归档</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/tags/">标签</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/about/">关于</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/links/">友链</a>
          </li>
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="view intro-2" id="background" parallax=true
         style="background: url('/css/images/bg/bg5.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask rgba-black-light flex-center">
          <div class="container text-center white-text fadeInUp">
            <span class="h2" id="subtitle">
              
            </span>

            
              
                <p class="mt-3 post-meta">
                  <i class="fas fa-calendar-alt" aria-hidden="true"></i>
                  星期二, 十月 15日 2024, 4:29 下午
                </p>
              

              <p class="mt-1">
                
                  
                  <span class="post-meta">
                    <i class="far fa-chart-bar"></i>
                    1.7k 字
                  </span>
                

                
                  
                  <span class="post-meta">
                      <i class="far fa-clock"></i>
                      9 分钟
                  </span>
                

                
                  <!-- 不蒜子统计文章PV -->
                  
                  <span id="busuanzi_container_page_pv" class="post-meta" style="display: none">
                    <i class="far fa-eye" aria-hidden="true"></i>
                    <span id="busuanzi_value_page_pv"></span> 次
                  </span>
                
              </p>
            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-md">
      <div class="container nopadding-md" id="board-ctn">
        <div class="py-5 z-depth-3" id="board">
          <div class="post-content mx-auto" id="post">
            
            <div class="markdown-body">
              <h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>学学用Rocket框架搞一搞web开发。</p>
<span id="more"></span>

<hr>
<h3 id="Optional和Result"><a href="#Optional和Result" class="headerlink" title="Optional和Result"></a>Optional和Result</h3><p>先补一下之前漏掉的重要内容，Rust的错误处理。</p>
<h4 id="主动报错panic"><a href="#主动报错panic" class="headerlink" title="主动报错panic"></a>主动报错panic</h4><p>相当于PHP下面的exit函数，调用之后会打印错误信息，然后退出程序：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">for</span> <span class="variable">n</span> <span class="keyword">in</span> <span class="number">1</span>..=<span class="number">100</span> &#123;</span><br><span class="line">        <span class="keyword">match</span> n &#123;</span><br><span class="line">            <span class="number">1</span> =&gt; <span class="built_in">println!</span>(<span class="string">&quot;One!!!0x&#123;:x&#125;&quot;</span>, n),</span><br><span class="line">            <span class="number">2</span> | <span class="number">4</span> | <span class="number">6</span> | <span class="number">8</span> =&gt; <span class="built_in">println!</span>(<span class="string">&quot;Two!!!0x&#123;:x&#125;&quot;</span>, n),</span><br><span class="line">            <span class="number">20</span>..=<span class="number">30</span> =&gt; <span class="built_in">println!</span>(<span class="string">&quot;Three!!!0x&#123;:x&#125;&quot;</span>, n),</span><br><span class="line">            _ =&gt; <span class="built_in">panic!</span>(<span class="string">&quot;No!&quot;</span>),</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">PS D:\Code\Rust\study&gt; .\index.exe</span><br><span class="line">One!!!0x1</span><br><span class="line">Two!!!0x2</span><br><span class="line">thread &#x27;main&#x27; panicked at .\index.rs:9:18:</span><br><span class="line">No!</span><br></pre></td></tr></table></figure>

<h4 id="空值检查Optional"><a href="#空值检查Optional" class="headerlink" title="空值检查Optional"></a>空值检查Optional</h4><p>大部分语言以空值为对象调用函数都会发生一个空指针错误，在Java语言下一般会事先通过判断值是否为null的方式（如!&#x3D;或者Optional）来规避这种错误，而在Rust语言下，这种情况可以用Option加上match匹配的方式来解决：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">get_data</span>(i: <span class="type">u8</span>) <span class="punctuation">-&gt;</span> <span class="type">Option</span>&lt;<span class="type">String</span>&gt;&#123;</span><br><span class="line">    <span class="keyword">if</span> i &lt; <span class="number">3</span> &#123;</span><br><span class="line">        <span class="title function_ invoke__">Some</span>(i.<span class="title function_ invoke__">to_string</span>())</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="literal">None</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">check</span>(data: <span class="type">Option</span>&lt;<span class="type">String</span>&gt;) &#123;</span><br><span class="line">    <span class="keyword">match</span> data &#123;</span><br><span class="line">        <span class="title function_ invoke__">Some</span>(inner) =&gt; <span class="built_in">println!</span>(<span class="string">&quot;Number: &#123;&#125;.&quot;</span>, inner),</span><br><span class="line">        <span class="literal">None</span> =&gt; <span class="built_in">println!</span>(<span class="string">&quot;None.&quot;</span>),</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">for</span> <span class="variable">n</span> <span class="keyword">in</span> <span class="number">1</span>..=<span class="number">3</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">res</span>: <span class="type">Option</span>&lt;<span class="type">String</span>&gt; = <span class="title function_ invoke__">get_data</span>(n);</span><br><span class="line">        <span class="title function_ invoke__">check</span>(res);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Option里面只有两种类型，代表有数值的Some和代表空值的None。</p>
<h4 id="错误检查Result"><a href="#错误检查Result" class="headerlink" title="错误检查Result"></a>错误检查Result</h4><p>除了空指针问题，代码运行时还经常会遇到错误，比如字符串转换为数字的格式错误，此时就可以用Result：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::num::ParseIntError;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">get_number</span>(s: &amp;<span class="type">str</span>) <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;<span class="type">i32</span>, ParseIntError&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">n</span> = <span class="keyword">match</span> s.parse::&lt;<span class="type">i32</span>&gt;() &#123;</span><br><span class="line">        <span class="title function_ invoke__">Ok</span>(n)  =&gt; n,</span><br><span class="line">        <span class="title function_ invoke__">Err</span>(e) =&gt; <span class="keyword">return</span> <span class="title function_ invoke__">Err</span>(e),</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="title function_ invoke__">Ok</span>(n + <span class="number">1</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">print</span>(res: <span class="type">Result</span>&lt;<span class="type">i32</span>, ParseIntError&gt;) &#123;</span><br><span class="line">    <span class="keyword">match</span> res &#123;</span><br><span class="line">        <span class="title function_ invoke__">Ok</span>(n)  =&gt; <span class="built_in">println!</span>(<span class="string">&quot;n is &#123;&#125;&quot;</span>, n),</span><br><span class="line">        <span class="title function_ invoke__">Err</span>(e) =&gt; <span class="built_in">println!</span>(<span class="string">&quot;Error: &#123;&#125;&quot;</span>, e),</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="title function_ invoke__">print</span>(<span class="title function_ invoke__">get_number</span>(<span class="string">&quot;01234&quot;</span>));</span><br><span class="line">    <span class="title function_ invoke__">print</span>(<span class="title function_ invoke__">get_number</span>(<span class="string">&quot;no&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Result里面同样也只有两种类型，代表执行正常的Ok和代表执行异常的Err，如果执行异常，可以在match中使用return语句提前跳出函数返回结果。</p>
<h4 id=""><a href="#" class="headerlink" title="?"></a>?</h4><p>也是提前返回的功能，遇到问题时会返回一个Err：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::num::ParseIntError;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">get_number</span>(s1: &amp;<span class="type">str</span>, s2: &amp;<span class="type">str</span>) <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;<span class="type">i32</span>, ParseIntError&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">n1</span> = s1.parse::&lt;<span class="type">i32</span>&gt;()?;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">n2</span> = s2.parse::&lt;<span class="type">i32</span>&gt;()?;</span><br><span class="line">    <span class="title function_ invoke__">Ok</span>(n1 + n2)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">print</span>(res: <span class="type">Result</span>&lt;<span class="type">i32</span>, ParseIntError&gt;) &#123;</span><br><span class="line">    <span class="keyword">match</span> res &#123;</span><br><span class="line">        <span class="title function_ invoke__">Ok</span>(n)  =&gt; <span class="built_in">println!</span>(<span class="string">&quot;n is &#123;&#125;&quot;</span>, n),</span><br><span class="line">        <span class="title function_ invoke__">Err</span>(e) =&gt; <span class="built_in">println!</span>(<span class="string">&quot;Error: &#123;&#125;&quot;</span>, e),</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="title function_ invoke__">print</span>(<span class="title function_ invoke__">get_number</span>(<span class="string">&quot;01234&quot;</span>, <span class="string">&quot;43210&quot;</span>));</span><br><span class="line">    <span class="title function_ invoke__">print</span>(<span class="title function_ invoke__">get_number</span>(<span class="string">&quot;no&quot;</span>, <span class="string">&quot;1&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h3><p>开始学习Rocker Web开发，首先要用包管理工具cargo创建一个新的项目：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cargo new rocket-web --bin</span><br></pre></td></tr></table></figure>

<p>注意项目名不要与rocket一致，然后安装rocket依赖：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cargo add rocket</span><br></pre></td></tr></table></figure>

<h3 id="Hello-World"><a href="#Hello-World" class="headerlink" title="Hello World"></a>Hello World</h3><p>直接复制黏贴到main.rs里面测试一下：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[macro_use]</span> <span class="keyword">extern</span> <span class="keyword">crate</span> rocket;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[get(<span class="string">&quot;/&quot;</span>)]</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">index</span>() <span class="punctuation">-&gt;</span> &amp;<span class="symbol">&#x27;static</span> <span class="type">str</span> &#123;</span><br><span class="line">    <span class="string">&quot;Hello, world!&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[launch]</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">rocket</span>() <span class="punctuation">-&gt;</span> _ &#123;</span><br><span class="line">    rocket::<span class="title function_ invoke__">build</span>().<span class="title function_ invoke__">mount</span>(<span class="string">&quot;/&quot;</span>, routes![index])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后编译：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cargo build</span><br></pre></td></tr></table></figure>

<p>第一次编译要把依赖都编译了，还挺久的，然后运行：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.\target\debug\rocket-web.exe</span><br></pre></td></tr></table></figure>

<p>或者用cargo run命令也可以，Hello World运行成功，还有一些日志记录：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET / text/html:</span><br><span class="line">   &gt;&gt; Matched: (index) GET /</span><br><span class="line">   &gt;&gt; Outcome: Success(200 OK)</span><br><span class="line">   &gt;&gt; Response succeeded.</span><br><span class="line">GET /favicon.ico image/avif:</span><br><span class="line">   &gt;&gt; No matching routes for GET /favicon.ico image/avif.</span><br><span class="line">   &gt;&gt; No 404 catcher registered. Using Rocket default.</span><br><span class="line">   &gt;&gt; Response succeeded.</span><br></pre></td></tr></table></figure>

<h3 id="JSON"><a href="#JSON" class="headerlink" title="JSON"></a>JSON</h3><p>先在项目里引入一下序列化、反序列化和JSON：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> rocket::serde::&#123;Deserialize, Serialize, json::Json&#125;;</span><br></pre></td></tr></table></figure>

<p>但是出现问题：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unresolved import `rocket::serde::json`</span><br></pre></td></tr></table></figure>

<p>serde是Rust序列化、反序列化框架，根据rocket的<a href="https://rocket.rs/guide/v0.5/requests/#json">官方文档</a>的描述，想要使用rocket的serde框架，需要修改配置文件Cargo.toml，将dependencies下面的内容改为：</p>
<figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">rocket</span> = &#123; version = <span class="string">&quot;0.5.1&quot;</span>, features = [<span class="string">&quot;json&quot;</span>] &#125;</span><br><span class="line"><span class="attr">serde</span> = &#123; version = <span class="string">&quot;1.0&quot;</span>, features = [<span class="string">&quot;derive&quot;</span>] &#125;</span><br><span class="line"><span class="attr">serde_json</span> = <span class="string">&quot;1.0&quot;</span></span><br></pre></td></tr></table></figure>

<p>然后再次build就没问题了，根据<a href="https://course.rs/cargo/reference/features/intro.html">官方文档</a>，features为条件编译，可选择项目需要的依赖。</p>
<p>解决了依赖引入问题，然后定义一个结构体和一个接收JSON格式数据的路由：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[macro_use]</span> <span class="keyword">extern</span> <span class="keyword">crate</span> rocket;</span><br><span class="line"><span class="keyword">use</span> rocket::serde::&#123;Deserialize, Serialize, json::Json&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[derive(Debug, Deserialize, Serialize)]</span></span><br><span class="line"><span class="meta">#[serde(crate = <span class="string">&quot;rocket::serde&quot;</span>)]</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">User</span>&lt;<span class="symbol">&#x27;a</span>&gt; &#123;</span><br><span class="line">    uid: <span class="type">u8</span>,</span><br><span class="line">    username: &amp;<span class="symbol">&#x27;a</span> <span class="type">str</span>,</span><br><span class="line">    password: &amp;<span class="symbol">&#x27;a</span> <span class="type">str</span>,</span><br><span class="line">    login_status: <span class="type">bool</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[get(<span class="string">&quot;/&quot;</span>)]</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">index</span>() <span class="punctuation">-&gt;</span> &amp;<span class="symbol">&#x27;static</span> <span class="type">str</span> &#123;</span><br><span class="line">    <span class="string">&quot;Hello, world!&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[post(<span class="string">&quot;/login&quot;</span>, data = <span class="string">&quot;&lt;user&gt;&quot;</span>)]</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">login</span>(user: Json&lt;User&gt;) <span class="punctuation">-&gt;</span> Json&lt;User&gt; &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Received user: &#123;:?&#125;&quot;</span>, user);</span><br><span class="line">    <span class="title function_ invoke__">Json</span>(User &#123;</span><br><span class="line">        uid: user.uid,</span><br><span class="line">        username: user.username,</span><br><span class="line">        password: user.password,</span><br><span class="line">        login_status: user.login_status,</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[launch]</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">rocket</span>() <span class="punctuation">-&gt;</span> _ &#123;</span><br><span class="line">    rocket::<span class="title function_ invoke__">build</span>().<span class="title function_ invoke__">mount</span>(<span class="string">&quot;/&quot;</span>, routes![index])</span><br><span class="line">                    .<span class="title function_ invoke__">mount</span>(<span class="string">&quot;/&quot;</span>, routes![login])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接受一个JSON数据，然后原样返回。</p>
<h3 id="Cookies"><a href="#Cookies" class="headerlink" title="Cookies"></a>Cookies</h3><p>有登录自然就要有保存登陆状态的功能，在Rocket框架中可以靠加密cookie的方式来实现：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[macro_use]</span> <span class="keyword">extern</span> <span class="keyword">crate</span> rocket;</span><br><span class="line"><span class="keyword">use</span> rocket::serde::&#123;Deserialize, Serialize, json::Json&#125;;</span><br><span class="line"><span class="keyword">use</span> rocket::http::CookieJar;</span><br><span class="line"><span class="keyword">use</span> serde_json;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[derive(Debug, Deserialize, Serialize)]</span></span><br><span class="line"><span class="meta">#[serde(crate = <span class="string">&quot;rocket::serde&quot;</span>)]</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">User</span>&lt;<span class="symbol">&#x27;a</span>&gt; &#123;</span><br><span class="line">    uid: <span class="type">u8</span>,</span><br><span class="line">    username: &amp;<span class="symbol">&#x27;a</span> <span class="type">str</span>,</span><br><span class="line">    password: &amp;<span class="symbol">&#x27;a</span> <span class="type">str</span>,</span><br><span class="line">    status: <span class="type">bool</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[get(<span class="string">&quot;/&quot;</span>)]</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">index</span>(cookies: &amp;CookieJar&lt;&gt;) <span class="punctuation">-&gt;</span> Json&lt;<span class="type">bool</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">login_status</span>: <span class="type">bool</span>;</span><br><span class="line">    login_status = <span class="keyword">match</span> cookies.<span class="title function_ invoke__">get_private</span>(<span class="string">&quot;user&quot;</span>) &#123;</span><br><span class="line">        <span class="title function_ invoke__">Some</span>(cookie) =&gt; <span class="keyword">match</span> serde_json::from_str::&lt;User&gt;(cookie.<span class="title function_ invoke__">value</span>()) &#123;</span><br><span class="line">            <span class="title function_ invoke__">Ok</span>(user) =&gt; user.username == <span class="string">&quot;admin&quot;</span>,</span><br><span class="line">            <span class="title function_ invoke__">Err</span>(_) =&gt; <span class="literal">false</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="literal">None</span> =&gt; <span class="literal">false</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="title function_ invoke__">Json</span>(login_status)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[post(<span class="string">&quot;/login&quot;</span>, data = <span class="string">&quot;&lt;input_user&gt;&quot;</span>)]</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">login</span>&lt;<span class="symbol">&#x27;a</span>&gt;(cookies: &amp;CookieJar&lt;<span class="symbol">&#x27;a</span>&gt;, input_user: Json&lt;User&lt;<span class="symbol">&#x27;a</span>&gt;&gt;) <span class="punctuation">-&gt;</span> Json&lt;User&lt;<span class="symbol">&#x27;a</span>&gt;&gt; &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Received user: &#123;:?&#125;&quot;</span>, input_user);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">user</span> = User &#123;</span><br><span class="line">        uid: input_user.uid,</span><br><span class="line">        username: input_user.username,</span><br><span class="line">        password: input_user.password,</span><br><span class="line">        status: <span class="literal">true</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">match</span> serde_json::<span class="title function_ invoke__">to_string</span>(&amp;user) &#123;</span><br><span class="line">        <span class="title function_ invoke__">Ok</span>(json_str) =&gt; cookies.<span class="title function_ invoke__">add_private</span>((<span class="string">&quot;user&quot;</span>, json_str)),</span><br><span class="line">        <span class="title function_ invoke__">Err</span>(e) =&gt; <span class="built_in">println!</span>(<span class="string">&quot;Error: &#123;&#125;&quot;</span>, e),</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_ invoke__">Json</span>(user)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[get(<span class="string">&quot;/logout&quot;</span>)]</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">logout</span>&lt;<span class="symbol">&#x27;a</span>&gt;(cookies: &amp;CookieJar&lt;<span class="symbol">&#x27;_</span>&gt;) <span class="punctuation">-&gt;</span> Json&lt;<span class="type">bool</span>&gt; &#123;</span><br><span class="line">    cookies.<span class="title function_ invoke__">remove_private</span>(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">    <span class="title function_ invoke__">Json</span>(<span class="literal">true</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[launch]</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">rocket</span>() <span class="punctuation">-&gt;</span> _ &#123;</span><br><span class="line">    rocket::<span class="title function_ invoke__">build</span>().<span class="title function_ invoke__">mount</span>(<span class="string">&quot;/&quot;</span>, routes![index])</span><br><span class="line">                    .<span class="title function_ invoke__">mount</span>(<span class="string">&quot;/&quot;</span>, routes![login])</span><br><span class="line">                    .<span class="title function_ invoke__">mount</span>(<span class="string">&quot;/&quot;</span>, routes![logout])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h3><p>他的FileName总是不带后缀名，麻烦：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[post(<span class="string">&quot;/upload&quot;</span>, data = <span class="string">&quot;&lt;upload_file&gt;&quot;</span>)]</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">fn</span> <span class="title function_">upload</span>&lt;<span class="symbol">&#x27;a</span>&gt;(cookies: &amp;CookieJar&lt;<span class="symbol">&#x27;a</span>&gt;, upload_file: Form&lt;Upload&lt;<span class="symbol">&#x27;a</span>&gt;&gt;) <span class="punctuation">-&gt;</span> Status &#123;</span><br><span class="line">    <span class="keyword">if</span> !<span class="title function_ invoke__">check_login</span>(cookies) &#123;</span><br><span class="line">        <span class="keyword">return</span> Status::Unauthorized</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">upload_struct</span>: Upload&lt;<span class="symbol">&#x27;a</span>&gt;= upload_file.<span class="title function_ invoke__">into_inner</span>();</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">temp_file</span>: TempFile = upload_struct.file;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">saved_name</span>: &amp;<span class="type">str</span>;</span><br><span class="line">    <span class="keyword">match</span> temp_file.<span class="title function_ invoke__">raw_name</span>() &#123;</span><br><span class="line">        <span class="title function_ invoke__">Some</span>(file_name) =&gt; saved_name = file_name.<span class="title function_ invoke__">dangerous_unsafe_unsanitized_raw</span>().<span class="title function_ invoke__">as_str</span>(),</span><br><span class="line">        <span class="literal">None</span> =&gt; <span class="keyword">return</span> Status::InternalServerError</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">match</span> temp_file.<span class="title function_ invoke__">persist_to</span>(Path::<span class="title function_ invoke__">new</span>(<span class="string">&quot;C:/test&quot;</span>).<span class="title function_ invoke__">join</span>(saved_name)).<span class="keyword">await</span> &#123;</span><br><span class="line">        <span class="title function_ invoke__">Ok</span>(_) =&gt; <span class="built_in">println!</span>(<span class="string">&quot;Upload Successfully&quot;</span>),</span><br><span class="line">        <span class="title function_ invoke__">Err</span>(e) =&gt; <span class="built_in">println!</span>(<span class="string">&quot;Error: &#123;&#125;&quot;</span>, e),</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Title: &#123;&#125;&quot;</span>, upload_struct.category);</span><br><span class="line">    Status::Accepted</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="文件下载"><a href="#文件下载" class="headerlink" title="文件下载"></a>文件下载</h3><p>由于需要输出文件，所以返回类型不太一样：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[post(<span class="string">&quot;/download&quot;</span>, data = <span class="string">&quot;&lt;download&gt;&quot;</span>)]</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">fn</span> <span class="title function_">download</span>&lt;<span class="symbol">&#x27;a</span>&gt;(cookies: &amp;CookieJar&lt;<span class="symbol">&#x27;a</span>&gt;, download: Json&lt;Download&lt;<span class="symbol">&#x27;a</span>&gt;&gt;) <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;NamedFile, Status&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> !<span class="title function_ invoke__">check_login</span>(cookies) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">Err</span>(Status::Unauthorized)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Received download request: &#123;:?&#125;&quot;</span>, download);</span><br><span class="line">    NamedFile::<span class="title function_ invoke__">open</span>(Path::<span class="title function_ invoke__">new</span>(<span class="string">&quot;C:/test&quot;</span>).<span class="title function_ invoke__">join</span>(download.category).<span class="title function_ invoke__">join</span>(download.file_name)).<span class="keyword">await</span>.<span class="title function_ invoke__">map_err</span>(|_| Status::NotFound)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<p><a href="https://rustwiki.org/zh-CN/rust-by-example/error/option_unwrap.html">官方文档-错误管理</a></p>
<p><a href="https://kaisery.github.io/trpl-zh-cn/ch01-03-hello-cargo.html">官方文档-cargo</a></p>
<p><a href="https://blog.vgot.net/archives/rust-some.html">Rust 学习之 Some、Option、Result</a></p>
<p><a href="https://www.cnblogs.com/timefiles/p/18082863">Rust Rocket简单入门</a></p>
<p><a href="https://rocket.rs/guide/v0.5/requests/#json">Rocket JSON</a></p>
<p><a href="https://course.rs/cargo/reference/features/intro.html">官方文档-features</a></p>

            </div>
            <hr>
            <div>
              <p>
                
                
                  <span>
                <i class="iconfont icon-tag"></i>
                    
                      <a class="hover-with-bg" href="/tags/Web/">Web</a>
                    
                      <a class="hover-with-bg" href="/tags/Rust/">Rust</a>
                    
                      <a class="hover-with-bg" href="/tags/Rocket/">Rocket</a>
                    
                  </span>
                
              </p>
              
                <p class="note note-warning">本博客所有文章除特别声明外，均采用 <a href="https://zh.wikipedia.org/wiki/Wikipedia:CC_BY-SA_3.0%E5%8D%8F%E8%AE%AE%E6%96%87%E6%9C%AC" rel="nofollow noopener">CC BY-SA 3.0协议</a> 。转载请注明出处！</p>
              
              
                <div class="post-prevnext row">
                  <div class="post-prev col-12 col-md-6">
                    
                      <a href="/2024/10/25/%E5%A4%8D%E4%B9%A0vue3-0-ElementUI/">
                        <i class="fa fa-chevron-left"></i>
                        <span>复习vue3.0+ElementUI</span>
                      </a>
                    
                  </div>
                  <div class="post-next col-12 col-md-6">
                    
                      <a href="/2024/10/09/Rust%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91%E5%85%A5%E9%97%A8/">
                        <span>Rust后端开发入门</span>
                        <i class="fa fa-chevron-right"></i>
                      </a>
                    
                  </div>
                </div>
              
            </div>

              
          </div>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc-start"></div>
<div id="toc">
  <p class="h5"><i class="far fa-list-alt"></i>&nbsp;目录</p>
  <div id="tocbot"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    
  </main>

  
    <a class="z-depth-1" id="scroll-top-button" href="#" role="button">
      <i class="fa fa-chevron-up scroll-top-arrow" aria-hidden="true"></i>
    </a>
  

  
    <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
  

  

  

  <footer class="mt-5">
  <div class="text-center py-3">
    <div>
      <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><b>Hexo</b></a>
      <i class="iconfont icon-love"></i>
      <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"> <b>Fluid</b></a>
    </div>
    

    

    
  </div>
</footer>

<!-- SCRIPTS -->
<script  src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js" ></script>
<script  src="https://cdn.staticfile.org/popper.js/1.16.1/umd/popper.min.js" ></script>
<script  src="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/js/bootstrap.min.js" ></script>
<script  src="https://cdn.staticfile.org/mdbootstrap/4.13.0/js/mdb.min.js" ></script>
<script  src="/js/main.js" ></script>


  <script  src="/js/lazyload.js" ></script>



  
  <script  src="https://cdn.staticfile.org/tocbot/4.10.0/tocbot.min.js" ></script>
  <script>
    $(document).ready(function () {
      var navHeight = $('#navbar').height();
      var toc = $('#toc');
      var boardCtn = $('#board-ctn');
      var boardTop = boardCtn.offset().top;
      var tocLimMax = 2 * boardTop + boardCtn.height();

      $(window).scroll(function () {
        var tocLimMin = $('#toc-start').offset().top - navHeight;
        var scroH = document.body.scrollTop + document.documentElement.scrollTop;

        if (tocLimMin <= scroH && scroH <= tocLimMax) {
          toc.css({
            'display': 'block',
            'position': 'fixed',
            'top': navHeight,
          });
        } else if (scroH <= tocLimMin) {
          toc.css({
            'position': '',
            'top': '',
          });
        } else if (scroH > tocLimMax) {
          toc.css('display', 'none');
        }
      });
      tocbot.init({
        tocSelector: '#tocbot',
        contentSelector: '.post-content',
        headingSelector: 'h1,h2,h3,h4,h5,h6',
        linkClass: 'tocbot-link',
        activeLinkClass: 'tocbot-active-link',
        listClass: 'tocbot-list',
        isCollapsedClass: 'tocbot-is-collapsed',
        collapsibleClass: 'tocbot-is-collapsible',
        scrollSmooth: true,
        headingsOffset: -boardTop
      });
      if ($('.toc-list-item').length > 0) {
        $('#toc > p').css('visibility', 'visible');
      }
      var offset = boardCtn.css('margin-right')
      $('#toc-ctn').css({
        'right': offset
      })
    });
  </script>







  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>




<!-- Plugins -->



  <script  src="https://cdn.staticfile.org/prettify/188.0.0/prettify.min.js" ></script>
  <script>
    $(document).ready(function () {
      $('pre').addClass('prettyprint  linenums');
      prettyPrint();
    })
  </script>



  <script  src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js" ></script>
  <script>
    var typed = new Typed('#subtitle', {
      strings: [
        '  ',
        "RustWeb开发入门&nbsp;",
      ],
      cursorChar: "_",
      typeSpeed: 70,
      loop: false,
    });
    typed.stop();
    $(document).ready(function () {
      $(".typed-cursor").addClass("h2");
      typed.start();
    });
  </script>



  <script  src="https://cdn.staticfile.org/anchor-js/4.2.2/anchor.min.js" ></script>
  <script>
    anchors.options = {
      placement: "right",
      visible: "hover",
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    var path = "/local-search.xml";
    var inputArea = document.querySelector("#local-search-input");
    inputArea.onclick = function () {
      getSearchFile(path);
      this.onclick = null
    }
  </script>



  <script defer src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js" ></script>
  <script>
    $("#post img:not(.no-zoom img, img[no-zoom])").each(
      function () {
        var element = document.createElement("a");
        $(element).attr("data-fancybox", "images");
        $(element).attr("href", $(this).attr("src"));
        $(this).wrap(element);
      }
    );
  </script>












</body>
</html>
